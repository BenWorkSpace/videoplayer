<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ben's Video Player</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Plyr CSS -->
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
    <style>
      /* body {
        background-color: #121212;
      } */
      .video-container {
        max-width: 90%;
        margin: 0 auto;
      }
      .custom-plyr {
        --plyr-color-main: #007bff;
      }
      .quality-badge {
        position: absolute;
        top: 10px;
        right: 10px;
        z-index: 1000;
      }
    </style>
  </head>
  <body class="bg-dark py-5 align-items-center justify-content-center min-vh-100">
    <!-- <div class="container rounded shadow p-3" style="box-shadow: 0 0 10px rgba(255, 255, 255, 0.1) !important;"> -->
      <!-- <h1 class="text-center m-4 text-light">Video Player</h1> -->
      <div class="video-container position-relative rounded h-75 w-75" style="box-shadow: 0px 0px 25px rgba(255, 255, 255, 0.4) !important;">
        <span id="quality-badge" class="badge bg-primary quality-badge"></span>
        <video id="player" playsinline controls class="rounded shadow custom-plyr">
          {% for quality, url in video_urls.items() %}
          <source
            src="{{ url }}"
            type="video/mp4"
            size="{{ quality[:-1] }}"
            label="{{ quality }}"
          />
          {% endfor %}
        </video>
      </div>
    <!-- </div> -->

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Plyr JS -->
    <script src="https://cdn.plyr.io/3.7.8/plyr.js"></script>
    <script>
      const player = new Plyr("#player", {
        quality: {
          default: {{ default_quality }},
          options: [{% for quality in video_urls.keys() %}{{ quality[:-1] }}{% if not loop.last %}, {% endif %}{% endfor %}],
          forced: true,
          onChange: (e) => {
            console.log(`Quality changed to: ${e}`);
            updateQualityBadge(e);
          },
        },
        storage: {
          enabled: true,
          key: "playerSettings",
        },
      });

      player.on("ready", () => {
        player.fullscreen.enter();
        updateQualityBadge(player.quality);
      });

      function updateQualityBadge(quality) {
        const badge = document.getElementById('quality-badge');
        badge.textContent = quality + 'p';
      }
    </script>
  </body>
</html>
